Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/bionic64"
  
  config.vm.provider "virtualbox" do |vb|
    vb.customize ["modifyvm", :id, "--memory", "1024"]
    vb.customize ["modifyvm", :id, "--cpus", "1"]
  end
  config.vm.network "private_network", type: "dhcp"
  
  # require plugin https://github.com/leighmcculloch/vagrant-docker-compose
  config.vagrant.plugins = "vagrant-docker-compose"
  
  config.vm.provision :docker
  config.vm.provision :docker_compose
  
  config.vm.define "salt" do |salt|
    salt.vm.hostname = "salt"
    config.vm.network "private_network", ip: "10.20.30.40"
    salt.vm.provision "file", source: "../salt/docker-compose.yml", destination: "$HOME/salt/docker-compose.yml"
    salt.vm.provision "shell", inline: "docker-compose -f /home/vagrant/salt/docker-compose.yml up -d"
  end

  config.vm.define "minion" do |minion|
    minion.vm.hostname = "minion"
    minion.vm.provision "shell", inline: "curl -o bootstrap-salt.sh -L https://bootstrap.saltproject.io && sudo sh bootstrap-salt.sh -P stable 3003.3"
  end

end